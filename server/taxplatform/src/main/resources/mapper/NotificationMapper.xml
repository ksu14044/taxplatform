<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.taxplatform.mapper.NotificationMapper">
    
    <!-- 알람 생성 -->
    <insert id="insertNotification" parameterType="com.taxplatform.domain.Notification" useGeneratedKeys="true" keyProperty="notificationId">
        INSERT INTO notifications (
            user_id, sender_id, type, message, is_read, created_at
        )
        VALUES (
            #{userId}, #{senderId}, #{type}, #{message}, #{isRead}, NOW()
        )
    </insert>
    
    <!-- 사용자별 알람 목록 조회 -->
    <select id="findByUserId" parameterType="Long" resultType="com.taxplatform.domain.Notification">
        SELECT 
            notification_id as notificationId,
            user_id as userId,
            sender_id as senderId,
            type,
            message,
            is_read as isRead,
            created_at as createdAt
        FROM notifications
        WHERE user_id = #{userId}
        ORDER BY created_at DESC
    </select>
    
    <!-- 알람 읽음 처리 -->
    <update id="markAsRead" parameterType="Long">
        UPDATE notifications
        SET is_read = TRUE
        WHERE notification_id = #{notificationId}
    </update>
    
    <!-- 읽지 않은 알람 개수 조회 -->
    <select id="countUnreadByUserId" parameterType="Long" resultType="int">
        SELECT COUNT(*)
        FROM notifications
        WHERE user_id = #{userId} AND is_read = FALSE
    </select>
    
</mapper>
